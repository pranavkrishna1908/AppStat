---
title: "Rough WOrk"
output: html_document
date: "2023-04-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(readr)
library(tidyverse)
X4_US_elections <- read_table("E:/EPFL/AppStat/AppStat/Data/4_US_elections.txt")
Election_data = X4_US_elections
Election_data$Region = rep(0, nrow(Election_data))
Northeast = c(7 ,8 ,19, 20, 21, 29, 30, 32, 38, 39, 45, 48)
South = c(1, 4, 9, 10, 17, 18, 24, 33, 36, 40, 42, 43, 46)
Midwest = c(13 ,14 ,15 ,16 ,22 ,23 ,25 ,27 ,34 ,35 ,41 ,49)
West = c(2 ,3 ,5 ,6 ,11 ,12 ,26 ,28 ,31 ,37 ,44 ,47 ,50)
Election_data$Region[which(Election_data$state %in% West)] = 'West'
Election_data$Region[which(Election_data$state %in% Midwest)] = 'Midwest'
Election_data$Region[which(Election_data$state %in% South)] = 'South'
Election_data$Region[which(Election_data$state %in% Northeast)] = 'Northeast'
Election_data$constant = NULL
Election_data$state = as.factor(Election_data$state)
Election_data$year = as.factor(Election_data$year)
Election_data = drop_na(Election_data)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
linear_model = lm(Dvote~. - Region, data = Election_data)
ungrouped_residuals = linear_model$residuals

ggplot(data = Election_data, aes(y = linear_model$residuals, col =  state)) + 
  geom_boxplot() + 
  labs(caption = "Figure: Residuals grouped by state.") + 
  ggtitle("s") + 
  theme(plot.caption = element_text(size = 18))

```




```{r}
# sub_election_data = Election_data[,c("Dvote",  "year",   "state",  "evotes")]
# 
# linear_model_sub = lm(Dvote~. - Region, data = sub_election_data)
# ungrouped_residuals = linear_model$residuals
# 
# ggplot(data = Election_data, aes(y = linear_model_sub$residuals, col =  state)) + 
#   geom_boxplot() + 
#   labs(caption = "Figure: Residuals grouped by state.") + 
#   ggtitle("s") + 
#   theme(plot.caption = element_text(size = 18))

```

cannot see clear dependence even without the extra variables when I group by state. Let it be. DO the mixed model for full data


Anyway, try year and region because region didnt work, works!! hannes

```{r}
tempdata = Election_data
tempdata$group = paste(tempdata$Region , tempdata$year)
ggplot(data = tempdata, aes(y = linear_model$residuals, col =  group)) + 
  geom_boxplot() + 
  labs(caption = "Figure: Residuals grouped by region and year") + 
  ggtitle("s") + 
  theme(plot.caption = element_text(size = 18))
```



```{r}
#Anova(linear_model, test = 'LR', type = 2)
```

```{r}
library(lme4)
mixed_model = lmer(Dvote~. -evotes + (1|state), data=Election_data,REML=F)
mixed_model = lmer(Dvote~.-evotes + (1|state) + (1|year), data=Election_data,REML=F)
mixed_model = lmer(Dvote~. -evotes+ (1|state) + (1|year) - state - year, data=Election_data,REML=F)


```
cant take year as random effect as one column of hard south is a fixed effect, can I?
Year is also in n1, n2,n3,n4 
50 state thereresfore 50 state idologies I gues, another problem

Follow whats asid

```{r}
mixed_model1 = lmer(Dvote~. -evotes  - year + (1|year) + (1|year:Region), data=Election_data,REML=F)
mixed_model2 = lmer(Dvote~. -evotes - state - year + (1|year) , data=Election_data,REML=F)
#plot(mixed_model)
ggplot(data = tempdata, aes(y = residuals(mixed_model1), col =  group)) + 
    geom_boxplot() + 
    labs(caption = "Figure: Residuals grouped by region and year") + 
    ggtitle("s") + 
    theme(plot.caption = element_text(size = 18))
```

So, the residuals are less dependent in that there are less boxplots away from zero now.

This is prefereable as the aic goes down significantly
```{r}
mixed_model1 = lmer(Dvote~. -evotes  - year + (1|year) + (1|year:Region), data=Election_data,REML=F)
mixed_model1a = lmer(Dvote~. -evotes  - year  + (1|year:Region), data=Election_data,REML=F)
anova(mixed_model1, mixed_model1a)
```

